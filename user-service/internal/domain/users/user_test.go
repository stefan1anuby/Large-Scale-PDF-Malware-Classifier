package users_test

import (
	"testing"

	"github.com/stretchr/testify/assert"

	"user-service/internal/domain/roles"
	"user-service/internal/domain/users"
)

func TestNewUser(t *testing.T) {
	username := "username123"
	password := "password123"
	email := "user_email@gmail.com"
	roles := []roles.Role{}

	user, err := users.NewUser(username, email, password, roles, 0)

	assert.Nil(t, err)
	assert.NotNil(t, user)
	assert.Equal(t, username, user.Username)
	assert.Equal(t, email, user.Email)
	assert.Equal(t, roles, user.Roles)
	
	assert.NotEqual(t, password, user.HashedPassword)
}

func TestCheckPassword(t *testing.T){
	username := "username123"
	password := "password123"
	email := "user_email@gmail.com"
	roles := []roles.Role{}

	user, err := users.NewUser(username, email, password, roles, 0)
	
	assert.Nil(t, err)
	assert.True(t, user.CheckPassword(password))
	assert.False(t, user.CheckPassword(password + "test"))
}

func TestChangePassword(t *testing.T) {
    username := "username123"
	password := "password123"
	email := "user_email@gmail.com"
	roles := []roles.Role{}

	user, err := users.NewUser(username, email, password, roles,0)
    assert.Nil(t, err)

	var new_password = "something"
    err = user.ChangePassword(new_password)
	
	assert.Nil(t, err)
    assert.True(t, user.CheckPassword(new_password))
}